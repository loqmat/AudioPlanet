<!doctype html>
<html>
<head>
    <title> Computer Graphics Project </title>
    
    <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec2 vPosition;

    void
    main()
    {
        gl_Position = vec4(vPosition,0,1);
        gl_PointSize = 4.0;
    }
    </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;
    uniform vec4 uColor;

    void
    main()
    {
        gl_FragColor = uColor;
    }
    </script>
    
    <script id="sphere-vshader" type="x-shader/x-vertex">
    #define M_PI 3.1415926535897932384626433832795
    
    uniform float audioData[1024];
    uniform vec3 audioBumps[1024];
    
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    uniform mat3 normalMatrix;
    
    attribute vec2 vPosition;
    attribute vec2 vUV;
    
    varying vec2 fUV;
    varying vec3 fNormal;
    varying vec3 fColor;

    void
    main()
    {
        float theta = vPosition.x;
        float phi = vPosition.y;
        
        float cosTheta = cos(theta);
        float sinTheta = sin(theta);
        float cosPhi = cos(phi);
        float sinPhi = sin(phi);
        
        vec3 position = normalize(vec3(cosPhi * sinTheta, cosTheta, sinPhi * sinTheta));
        
        float h = 0.5;
        for ( int i=0;i<1024;i++ ) {
            float distance = acos(dot(position, audioBumps[i])) / M_PI;
            float gauss = exp2(-256.0*distance*distance) / 2.0;
            h += audioData[i] * gauss;
        }
        
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position * h, 1);
        gl_PointSize = 16.0 / (1.0+gl_Position.z*gl_Position.z);
        
        fUV = vUV;
        fNormal = position;
        
        fColor = vec3( 1.0 / ( 1.0 + h ),
                       ( h + 1.0 ) / 2.0,
                       h / 2.0 );
    }
    </script>
    
    <script id="sphere-fshader" type="x-shader/x-vertex">
    precision mediump float;
    varying vec2 fUV;
    varying vec3 fNormal;
    varying vec3 fColor;
    
    uniform vec3 uLightDirection;
    uniform vec4 uColor;

    void
    main()
    {
        float stren = clamp(dot(uLightDirection, fNormal), 0.0, 1.0);
        gl_FragColor = fColor.b * vec4(fColor.rgb,1) + (1.0-fColor.b) * vec4(fColor.rgb * stren, 1);
    }
    </script>
    
    <script type="text/javascript" src="./lib/webgl-utils.js"></script>
    <script type="text/javascript" src="./lib/initShaders.js"></script>
    <script type="text/javascript" src="./lib/MV.js"></script>
    <script type="text/javascript" src="./lib/quaternions.js"></script>
    <script type="text/javascript" src="./tetrahedron.js"></script>
    <script type="text/javascript" src="./generateSphere.js"></script>
    <script type="text/javascript" src="./main.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <input id="loadFile" type="file"/>
    <canvas id="GLCanvas">
        Oops ... your browser doesn't support the HTML5 canvas element
    </canvas>
</body>
</html>